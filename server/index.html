<!DOCTYPE html>
<html>
<h1>Socket Testing</h1>

<form>
	<input id="name" type="text" name="name" placeholder="Name">
	Latitude: <input type="number" name="lat" id="lat" min="55.00000" max="56.00000" step="0.00001" value="55.00000">
	Longitude: <input type="number" name="lng" id="lng" min="-5.00000" max="-4.00000" step="0.00001" value="-5.00000">
	Health: <input type="number" name="check-health" id="check-health" min="0" max="5" step="1" value="3">
</form>
<button id="join">Join Room</button>
<button id="update">Update Data</button>
<button id="fire">Fire</button>

<p id="display"></p>
<ul id="players"></ul>

<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>

	var socket = io();
	var socketId;
	var data = {};
	
	// Prevent reloading the page
	$("form").submit(function(e) {
		$("#join").trigger("click");
		return false;
	});
    
	//update health when value changed
	$(document).ready(function(){
		$('#check-health').on('change keyup', function() {
			data.health = $("#check-health").val();
			socket.emit("update-health", data);
		}); 
	});
	
	// Sending to the server
	$("#join").click(function() {
		
		data.name = $("#name").val();
		data.lat = $("#lat").val();
		data.lng = $("#lng").val();
		data ? socket.emit("login", data) : console.log("Enter data...");
	});

	$("#update").click(function() {
		var data = {
			id: socketId,
			lat: $("#lat").val(),
			lng: $("#lng").val()
		};
		socket.emit("update-player", data);
	});

	$("#fire").click(function() {
		socket.emit("fire");
	});

	// Receiving from the server
	socket.on("logged-in", function(id) {
		socketId = id;
		$("#display").append("<h4>Joined as ID "+id+"</h4>");
	});

	socket.on("update", function(data) {
		console.log(data);
		$("#players").html(" ");
		for (var p in data) {
			p = data[p];
			console.log(p);
			$("#players").append("<li>"+p.name+" "+p.lat+" "+p.lng+"</li>");
		}
	});

	socket.on("fire", function() {
		$("#fire").append("<h1>Shots Fired</h1>");
	});

</script>